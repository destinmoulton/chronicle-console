<!doctype html>
<html>
<head>
    <title>Chronicle Console - Actions</title>
    <script src="../index.js" ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <h3>Chronicle Console - Actions Tester</h3>
        <div id="loading">Loading Data...</div>
        <fieldset style="display:none" id="serverinfo">
            <legend>Configuration</legend>
            Server: <input type="text" id="input-server" size="60"/>
            <br/>
            App Test Name: <input type="text" id="input-app" size="60"/>
            <br/>
            <button id="start-test" onClick="startTest()">Initialize</button>
            <button onClick="clearLocalStorage()">Clear Local Storage</button>
        </fieldset>
    <hr>
    <div style="display:none" id="navbar">
        <button onClick="mockChangeView('home')">Home</button>
        <button onClick="mockChangeView('about')">About</button>
        <button onClick="mockChangeView('pricing')">Pricing</button>
        <button onClick="mockChangeView('contact')">Contact</button>
        <hr>
        <button onClick="login()" id="button-login">Login</button>
    </div>
    <div style="display:none" id="adminbar">    
        <button onClick="logout()" >Logout</button>
        <hr>
        
    </div>
    <script type="text/javascript">
        let TEST_DATA = {
            user: {}
        };
        $(()=>{
            const rando = Math.ceil(Math.random() * 10);

            const params = {
                method: "get",
                headers: {
                    'Origin':'https://swapi.co',
                    "Accept":"application/json"
                }
            }
            fetch("https://swapi.co/api/people/"+rando, params)
                .then((res)=>res.json())
                .then((person)=>{
                    TEST_DATA.user = person;
                    console.log("api:results", person);
                    $("#serverinfo").show();
                    $("#loading").hide();
                });

            if(localStorage.getItem("server")){
                $("#input-server").val(localStorage.getItem("server"));
            }

            if(localStorage.getItem("app")){
                $("#input-app").val(localStorage.getItem("app"));
            }

        });

        function clearLocalStorage(){
            localStorage.removeItem("server");
            localStorage.removeItem("app");
        }

        function startTest(){
            
            var server = document.getElementById("input-server").value;
            var app = document.getElementById("input-app").value;
            
            if( server && app){
                localStorage.setItem("server", server);
                localStorage.setItem("app", app);

                var config = {
                    server: server,
                    app: app,
                    toConsole: true
                }
                ChronicleConsole.init(config);

                console.log("test:initialized");

                // Show the navbar
                $("#navbar").show();
            }
        }

        function mockChangeView(viewName){
            console.action("user:browse", viewName);
        }

        function login(){
            console.action("user:login", TEST_DATA.user);
            $("#button-login").prop("disabled", true);
            $("#adminbar").show();
        }

        function logout(){
            console.action("user:logout");
            $("#button-login").prop("disabled", false);
            $("#adminbar").hide();
        }

    </script>
</body>
</html>